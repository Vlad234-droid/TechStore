{"ast":null,"code":"/* eslint-disable no-unused-vars */\n\n/* eslint-disable no-underscore-dangle */\nimport axios from 'axios';\nimport { DOMAIN, getHeaders } from '../general';\nimport updateWishlistCreator from './actionCreator';\nconst BASE_ENDPOINT = `${DOMAIN}/wishlist`;\n\nconst getParsedListFromLS = () => {\n  const check = localStorage.getItem('wishlist');\n  if (!check) localStorage.setItem('wishlist', JSON.stringify([]));\n  const items = localStorage.getItem('wishlist');\n  return JSON.parse(items);\n};\n\nconst addProductToLS = product => {\n  const prevItems = getParsedListFromLS();\n  const updatedItems = [...prevItems, product];\n  localStorage.setItem('wishlist', JSON.stringify(updatedItems));\n  return updatedItems;\n};\n\nconst removeProductFromLS = product => {\n  const prevItems = getParsedListFromLS();\n  const updatedItems = prevItems.filter(item => item._id !== product._id);\n  localStorage.setItem('wishlist', JSON.stringify(updatedItems));\n  return updatedItems;\n};\n\nconst getItemsFromDB = () => {\n  const headers = getHeaders();\n  return axios.get(BASE_ENDPOINT, {\n    headers\n  }).then(response => response).catch(err => console.log(err.response));\n};\n\nexport const setWishlist = () => async (dispatch, getState) => {\n  const {\n    auth: {\n      isLogin\n    }\n  } = getState();\n  const itemsToSet = [];\n\n  if (isLogin) {\n    const {\n      data,\n      status\n    } = await getItemsFromDB();\n    if (data && status === 200) itemsToSet.push(...data.products);\n  } else {\n    itemsToSet.push(...getParsedListFromLS());\n  }\n\n  const dataToAdd = {\n    wishitstItems: itemsToSet,\n    wishitstLength: itemsToSet.length\n  };\n  dispatch(updateWishlistCreator(dataToAdd));\n};\nexport const addProductToWishlist = product => async (dispatch, getState) => {\n  if (!product || !product._id) return;\n  const productID = product._id;\n  const {\n    auth: {\n      isLogin\n    }\n  } = getState();\n  const updatedList = [];\n\n  if (isLogin) {\n    const headers = getHeaders();\n    await axios.put(`${BASE_ENDPOINT}/${productID}`, null, {\n      headers\n    }).then(response => {\n      const {\n        data,\n        status\n      } = response;\n      if (data && status === 200) updatedList.push(...data.products);\n    }).catch(err => console.log(err.response));\n  } else {\n    const updatedItems = addProductToLS(product);\n    updatedList.push(...updatedItems);\n  }\n\n  const dataToAdd = {\n    wishitstItems: updatedList,\n    wishitstLength: updatedList.length\n  };\n  dispatch(updateWishlistCreator(dataToAdd));\n};\nexport const removeProductFromWishlist = product => async (dispatch, getState) => {\n  if (!product || !product._id) return;\n  const productID = product._id;\n  const {\n    auth: {\n      isLogin\n    }\n  } = getState();\n  const updatedList = [];\n\n  if (isLogin) {\n    const headers = getHeaders();\n    await axios.delete(`${BASE_ENDPOINT}/${productID}`, {\n      headers\n    }).then(response => {\n      const {\n        data,\n        status\n      } = response;\n      if (data && status === 200) updatedList.push(...data.products);\n    }).catch(err => console.log(err.response));\n  } else {\n    const updatedItems = removeProductFromLS(product);\n    updatedList.push(...updatedItems);\n  }\n\n  const dataToAdd = {\n    wishitstItems: updatedList,\n    wishitstLength: updatedList.length\n  };\n  dispatch(updateWishlistCreator(dataToAdd));\n};\nexport const compareLSItemsAndDBItems = () => async dispatch => {\n  const {\n    data,\n    status\n  } = await getItemsFromDB();\n  const itemsLS = getParsedListFromLS();\n  const itemsDB = [];\n  if (data && status === 200) itemsDB.push(...data.products);\n  const allItems = [...itemsLS, ...itemsDB];\n  const uniqueList = [];\n  allItems.forEach(el => {\n    const check = Boolean(uniqueList.find(item => item.itemNo === el.itemNo));\n    if (!check) uniqueList.push(el);\n  });\n  const dataToAdd = {\n    wishitstItems: uniqueList,\n    wishitstLength: uniqueList.length\n  };\n  dispatch(updateWishlistCreator(dataToAdd));\n  const updatedItems = {\n    products: uniqueList\n  };\n  const headers = getHeaders();\n  axios.put(BASE_ENDPOINT, updatedItems, {\n    headers\n  }).then(res => res).catch(err => console.log(err.response));\n};","map":{"version":3,"sources":["/Users/vladikbaryshpolets/Desktop/Final_project_Online-store/src/store/wishlist/middleware.js"],"names":["axios","DOMAIN","getHeaders","updateWishlistCreator","BASE_ENDPOINT","getParsedListFromLS","check","localStorage","getItem","setItem","JSON","stringify","items","parse","addProductToLS","product","prevItems","updatedItems","removeProductFromLS","filter","item","_id","getItemsFromDB","headers","get","then","response","catch","err","console","log","setWishlist","dispatch","getState","auth","isLogin","itemsToSet","data","status","push","products","dataToAdd","wishitstItems","wishitstLength","length","addProductToWishlist","productID","updatedList","put","removeProductFromWishlist","delete","compareLSItemsAndDBItems","itemsLS","itemsDB","allItems","uniqueList","forEach","el","Boolean","find","itemNo","res"],"mappings":"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","sourcesContent":["/* eslint-disable no-unused-vars */\n/* eslint-disable no-underscore-dangle */\nimport axios from 'axios'\nimport { DOMAIN, getHeaders } from '../general'\nimport updateWishlistCreator from './actionCreator'\n\nconst BASE_ENDPOINT = `${DOMAIN}/wishlist`\n\nconst getParsedListFromLS = () => {\n  const check = localStorage.getItem('wishlist')\n  if (!check) localStorage.setItem('wishlist', JSON.stringify([]))\n\n  const items = localStorage.getItem('wishlist')\n  return JSON.parse(items)\n}\nconst addProductToLS = (product) => {\n  const prevItems = getParsedListFromLS()\n  const updatedItems = [...prevItems, product]\n  localStorage.setItem('wishlist', JSON.stringify(updatedItems))\n  return updatedItems\n}\nconst removeProductFromLS = (product) => {\n  const prevItems = getParsedListFromLS()\n  const updatedItems = prevItems.filter((item) => item._id !== product._id)\n  localStorage.setItem('wishlist', JSON.stringify(updatedItems))\n  return updatedItems\n}\n\nconst getItemsFromDB = () => {\n  const headers = getHeaders()\n  return axios.get(BASE_ENDPOINT, { headers })\n    .then((response) => response)\n    .catch((err) => console.log(err.response))\n}\n\nexport const setWishlist = () => async (dispatch, getState) => {\n  const {auth: { isLogin }} = getState()\n  const itemsToSet = []\n  \n  if (isLogin) {\n    const { data, status } = await getItemsFromDB()\n    if (data && status === 200) itemsToSet.push(...data.products)\n  } else {\n    itemsToSet.push(...getParsedListFromLS())\n  }\n\n  const dataToAdd = {\n    wishitstItems: itemsToSet,\n    wishitstLength: itemsToSet.length\n  }\n  dispatch(updateWishlistCreator(dataToAdd))\n}\n\nexport const addProductToWishlist = (product) => async (dispatch, getState) => {\n  if (!product || !product._id) return\n\n  const productID = product._id\n  const {auth: { isLogin }} = getState()\n  const updatedList = []\n\n  if (isLogin) {\n    const headers = getHeaders()\n    await axios.put(`${BASE_ENDPOINT}/${productID}`, null, { headers })\n      .then((response) => {\n        const { data, status } = response\n        if (data && status === 200) updatedList.push(...data.products)\n      })\n      .catch((err) => console.log(err.response))\n  } else {\n    const updatedItems = addProductToLS(product)\n    updatedList.push(...updatedItems)\n  }\n  const dataToAdd = {\n    wishitstItems: updatedList,\n    wishitstLength: updatedList.length\n  }\n  dispatch(updateWishlistCreator(dataToAdd))\n}\n\nexport const removeProductFromWishlist = (product) => async (dispatch, getState) => {\n  if (!product || !product._id) return\n\n  const productID = product._id\n  const {auth: { isLogin }} = getState()\n  const updatedList = []\n  \n  if (isLogin) {\n    const headers = getHeaders()\n    await axios.delete(`${BASE_ENDPOINT}/${productID}`, { headers })\n      .then((response) => {\n        const { data, status } = response\n        if (data && status === 200) updatedList.push(...data.products)\n      })\n      .catch((err) => console.log(err.response))\n  } else {\n    const updatedItems = removeProductFromLS(product)\n    updatedList.push(...updatedItems)\n  }\n\n  const dataToAdd = {\n    wishitstItems: updatedList,\n    wishitstLength: updatedList.length\n  }\n  dispatch(updateWishlistCreator(dataToAdd))\n}\n\nexport const compareLSItemsAndDBItems = () => async (dispatch) => {\n  const { data, status } = await getItemsFromDB()\n  const itemsLS = getParsedListFromLS()\n  const itemsDB = []\n  if (data && status === 200) itemsDB.push(...data.products)\n  const allItems = [...itemsLS, ...itemsDB]\n  \n  const uniqueList = []\n  allItems.forEach((el) => {\n    const check = Boolean(uniqueList.find((item) => item.itemNo === el.itemNo))\n    if (!check) uniqueList.push(el)\n  })\n  const dataToAdd = {\n    wishitstItems: uniqueList,\n    wishitstLength: uniqueList.length\n  }\n  dispatch(updateWishlistCreator(dataToAdd))\n\n  const updatedItems = {\n    products: uniqueList\n  }\n  const headers = getHeaders()\n  axios.put(BASE_ENDPOINT, updatedItems, { headers })\n    .then((res) => res)\n    .catch((err) => console.log(err.response))\n}\n"]},"metadata":{},"sourceType":"module"}